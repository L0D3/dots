// 
/**
 * A very simple db handler to administrate saved coupon codes
 */
function DBHandler () {
    this.db = window.openDatabase("qoupon", "1.0", "Qoupon DB", (10*1000*1000));
	this.init = function (tx) {
	     tx.executeSql('DROP TABLE IF EXISTS coupon');
	     tx.executeSql('CREATE TABLE IF NOT EXISTS coupon (cid, name, bonus, owner, code)');
	}
	
	this.errorDB = function(err) {
	    logcat.e("Error processing SQL: "+err.code);
	}

	this.successDB = function() {
		logcat.i("Database has been initialized.");
	}
	
    this.db.transaction(this.init, this.errorDB, this.successDB);
	this.getCoupons = function (callback) {
		this.db.transaction(function(tx) {
			tx.executeSql('SELECT * FROM coupon', [], callback, this.errorDB);

		}, this.errorDB);
	}
	
	this.addCoupon = function (cid, name, bonus, owner, code) {
		this.db.transaction(function(tx) {
			tx.executeSql('INSERT INTO coupon (cid, name, bonus, owner, code) VALUES ('+cid+', \''+name+'\', \''+bonus+'\', \''+owner+'\', \''+code+'\')', function() {logcat.i("inserted new code");});
		}, this.errorDB);
	}
	
	this.deleteCoupon = function (cid) {
	   this.db.transaction(function(tx) {
			tx.executeSql('DELETE FROM coupon WHERE cid = '+cid);
		}, this.errorDB);
	}
	

}
