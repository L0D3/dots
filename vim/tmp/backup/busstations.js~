var busstations={};
$( document ).delegate("#start", "pageinit", function() {
  console.log("dads");
  	$("#autocomplete").on("listviewbeforefilter", function(e, data) {
		console.log("dadad");
        var $ul = $(this),
        $input = $(data.input),
        value = $input.val(),
        html = "";
    $ul.html("");
    if (value && value.length > 2) {
        console.log($input.val());
        $ul.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");
        $ul.listview("refresh");
        console.log($input.val());
        $.ajax({
            'beforeSend': function(xhr) {
                //May need to use "Authorization" instead
                xhr.setRequestHeader("Authorization",
                    "Basic " + btoa("mobias:secret"));
                    },
            url: "http://sheltered-everglades-9379.herokuapp.com/api/mastens",
            dataType: "json",
            type:"GET",
            data: {
                term: $input.val()
            }
        })
        .then(function (response) {
            busstations={};
            $.each(response, function (i, val) {
                busstations[val.id]=val;
                html +='<li><a href="#station" onclick="saveBusstation('+val.id+','+val.x+','+val.y+')">'val.number+','+val.name+'</a></li>'
            });
            console.log(JSON.stringify(busstations));
            $ul.html(html);
            $ul.listview("refresh");
            $ul.trigger("updatelayout");
        });
    }
    });
});

    // $.getJSON("http://sheltered-everglades-9379.herokuapp.com/api/mastens", function(data){
    //     console.log(data);
    //     var output = '';
    //     $.each(data, function(index, value){
    //         busstations[""+value.id+""]=value;
    //         output += '<li class="ui-screen-hidden"><a href="#station" onclick="saveBusstation('+value.id+','+value.id+')">'+value.name+'</a></li>';

    //     });
    //     $('#autocomplete').empty().append(output).listview('refresh');
    // });
var cBusstation;
var cBusstationy;
var cBusstationx;
function saveBusstation(id,x,y){
    cBusstation=id;
    cBusstationx=x;
    cBusstationy=y;
    
}
